# API Reference for the `em_app` Package

This document provides a detailed API reference for the classes and methods in the `em_app` package.

## `biot_savart.py`

This module contains functions for calculating the magnetic field using the Biot-Savart law.

| Function | Description | Arguments | Returns |
| --- | --- | --- | --- |
| `serial_biot_savart` | Serial Biot-Savart calculation with element inputs. | `element_centers` (numpy.ndarray of float/int or mtf): (N, 3) array of center coordinates.<br>`element_lengths` (numpy.ndarray of float/int): (N,) array of lengths (dl).<br>`element_directions` (numpy.ndarray of float/int or mtf): (N, 3) array of unit vectors for current directions.<br>`field_points` (numpy.ndarray of float/int or mtf): (M, 3) array of field point coordinates.<br>`order` (int, optional): The maximum order of the Taylor series to compute. Defaults to `None`.<br>`backend` (str, optional): The backend to use ('python', 'cpp', 'c', 'cpp_v2'). Defaults to `'python'`. | `numpy.ndarray`: (M, 3) array of magnetic field vectors. |
| `mpi_biot_savart` | Parallel Biot-Savart calculation using mpi4py with element inputs. | `element_centers` (numpy.ndarray of float/int or mtf): (N, 3) array of center coordinates.<br>`element_lengths` (numpy.ndarray of float/int): (N,) array of lengths (dl).<br>`element_directions` (numpy.ndarray of float/int or mtf): (N, 3) array of unit vectors for current directions.<br>`field_points` (numpy.ndarray of float/int or mtf): (M, 3) array of field point coordinates.<br>`order` (int, optional): The maximum order of the Taylor series to compute. Defaults to `None`. | `numpy.ndarray` or `None`: On MPI rank 0, an (M, 3) array of magnetic field vectors. On other ranks, `None`. |
| `numpy_biot_savart` | NumPy vectorized Biot-Savart calculation using element inputs. | `element_centers` (numpy.ndarray of float/int or mtf): (N, 3) array of center coordinates.<br>`element_lengths` (numpy.ndarray of float/int): (N,) array of lengths (dl).<br>`element_directions` (numpy.ndarray of float/int or mtf): (N, 3) array of unit vectors for current directions.<br>`field_points` (numpy.ndarray of float/int or mtf): (M, 3) array of field point coordinates. | `numpy.ndarray`: (M, 3) array of magnetic field vectors. |

## `currentcoils.py`

This module defines classes for representing different current-carrying coil geometries.

### `Coil` Class

Base class for a current-carrying coil.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `current` | `float` or `mtf` | The current flowing through the coil. |
| `use_mtf_for_segments` | `bool` | Whether to use MTF for representing the coil segments. |
| `wire_thickness` | `float` | The thickness of the wire in meters. |
| `segment_centers` | `np.ndarray` | Array of the center points of the coil segments. |
| `segment_lengths` | `np.ndarray` | Array of the lengths of the coil segments. |
| `segment_directions` | `np.ndarray` | Array of the direction vectors of the coil segments. |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes the base Coil. | `current` (float or mtf): The current flowing through the coil.<br>`use_mtf_for_segments` (bool): Whether to use MTF for segments.<br>`wire_thickness` (float): The thickness of the wire in meters. | `None` |
| `get_segments` | Returns the discretized segments of the coil. | `None` | `tuple`: (segment_centers, segment_lengths, segment_directions) |
| `get_max_size` | Calculates the maximum extent of the coil. | `None` | `np.ndarray`: (3,) array of the maximum size (width, height, depth). |
| `get_center_point` | Calculates the approximate center point of the coil. | `None` | `np.ndarray`: (3,) array representing the center of the coil. |
| `plot` | Plots the coil segments in 3D. | `ax` (matplotlib.axes.Axes3D, optional): The 3D axis to plot on.<br>`color` (str, optional): The color for the segments.<br>`num_interpolation_points` (int, optional): Number of points to plot for each segment.<br>`wire_thickness` (float, optional): The thickness of the wire to plot.<br>`show_axis` (bool, optional): Whether to plot the central axis of the coil. | `None` |
| `biot_savart` | Calculates the magnetic field generated by the coil. | `field_points` (np.ndarray or np.ndarray of mtf): The points where the magnetic field should be calculated.<br>`backend` (str, optional): The backend to use for the calculation. | `Bfield`: A `Bfield` object containing the calculated magnetic field. |
| `plot_1d_field` | Plots a magnetic field component along a 1D line. | `field_component` (str): The component to plot ('Bx', 'By', 'Bz', 'B_norm').<br>`axis` (str, optional): The axis to plot along ('x', 'y', 'z').<br>`start_point` (np.ndarray, optional): The start point of the line.<br>`end_point` (np.ndarray, optional): The end point of the line.<br>`num_points` (int, optional): The number of points to sample.<br>`plot_type` (str, optional): The type of plot ('line', 'scatter').<br>`log_scale` (bool, optional): Whether to use a log scale for the y-axis.<br>`ax` (matplotlib.axes.Axes, optional): The axis to plot on.<br>`title` (str, optional): The plot title.<br>`xlabel` (str, optional): The x-axis label.<br>`ylabel` (str, optional): The y-axis label. | `None` |
| `plot_2d_field` | Plots a magnetic field on a 2D plane. | `field_component` (str, optional): The component to plot ('Bx', 'By', 'Bz', 'Bnorm').<br>`plane` (str, optional): The plane to plot on ('xy', 'yz', 'xz').<br>`center` (np.ndarray, optional): The center of the plane.<br>`normal` (np.ndarray, optional): The normal vector of a custom plane.<br>`size_a` (float, optional): The size of the plane in the first dimension.<br>`size_b` (float, optional): The size of the plane in the second dimension.<br>`num_points_a` (int, optional): The number of points in the first dimension.<br>`num_points_b` (int, optional): The number of points in the second dimension.<br>`plot_type` (str, optional): The type of plot ('quiver', 'streamline', 'heatmap').<br>`ax` (matplotlib.axes.Axes, optional): The axis to plot on.<br>`title` (str, optional): The plot title.<br>`offset_from_center` (float, optional): The offset of the plane from the center. | `None` |
| `plot_field_vectors_3d` | Generates a 3D quiver plot of the magnetic field vectors. | `num_points_a` (int, optional): Number of grid points along the x-dimension.<br>`num_points_b` (int, optional): Number of grid points along the y-dimension.<br>`num_points_c` (int, optional): Number of grid points along the z-dimension.<br>`title` (str, optional): The title of the plot.<br>`ax` (matplotlib.axes.Axes3D, optional): The 3D axis to plot on. | `None` |

### `RingCoil` Class

Represents a circular current-carrying coil. Inherits from `Coil`.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `radius` | `float` | Radius of the coil. |
| `num_segments` | `int` | Number of segments for discretization. |
| `center_point` | `np.ndarray` | (3,) array for the center coordinates. |
| `axis_direction` | `np.ndarray` | (3,) array for the axis direction. |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes a circular coil. | `current` (float or mtf): The current.<br>`radius` (float): Radius of the coil.<br>`num_segments` (int): Number of segments for discretization.<br>`center_point` (np.ndarray): (3,) array for the center coordinates.<br>`axis_direction` (np.ndarray): (3,) array for the axis direction.<br>`use_mtf_for_segments` (bool): Whether to use MTF for segments.<br>`wire_thickness` (float): The thickness of the wire in meters. | `None` |

### `RectangularCoil` Class

Represents a rectangular current-carrying coil. Inherits from `Coil`.

**Attributes**

This class inherits all attributes from the `Coil` class.

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes a rectangular coil. | `current` (float or mtf): The current.<br>`p1` (np.ndarray): First corner of the rectangle.<br>`p2` (np.ndarray): Second corner, defining the first side from p1.<br>`p4` (np.ndarray): Fourth corner, defining the second side from p1.<br>`num_segments_per_side` (int): Segments per side.<br>`use_mtf_for_segments` (bool): Whether to use MTF for segments.<br>`wire_thickness` (float): The thickness of the wire in meters. | `None` |

### `StraightWire` Class

Represents a single straight current-carrying wire. Inherits from `Coil`.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `start_point` | `np.ndarray` | The starting point of the wire. |
| `end_point` | `np.ndarray` | The ending point of the wire. |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes a straight wire. | `current` (float or mtf): The current.<br>`start_point` (np.ndarray): The starting point of the wire.<br>`end_point` (np.ndarray): The ending point of the wire.<br>`num_segments` (int, optional): Number of segments. Defaults to 1.<br>`use_mtf_for_segments` (bool): Whether to use MTF for segments.<br>`wire_thickness` (float): The thickness of the wire in meters. | `None` |

## `magneticfield.py`

This module defines classes for representing and manipulating magnetic field data.

### `Vector` Class

A generic class to represent a 3D vector.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `x` | `float` or `mtf` | The x-component of the vector. |
| `y` | `float` or `mtf` | The y-component of the vector. |
| `z` | `float` or `mtf` | The z-component of the vector. |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes the vector. | `*components`: Three separate numeric or MTF values, a list/tuple of three values, or a NumPy array of three values. | `None` |
| `from_array_of_vectors` | Creates a NumPy array of Vector objects from a 2D NumPy array. | `array` (np.ndarray): A NumPy array of shape (N, 3). | `np.ndarray`: A NumPy array of `Vector` objects. |
| `dot` | Calculates the dot product with another Vector object. | `other` (Vector): The Vector object to take the dot product with. | `mtf` or `float`: The scalar result of the dot product. |
| `cross` | Calculates the cross product with another Vector object. | `other` (Vector): The Vector object to take the cross product with. | `Vector`: A new Vector object representing the resulting vector. |
| `norm` | Calculates the magnitude (L2-norm) of the vector. | `None` | `float` or `mtf`: The scalar magnitude. |
| `is_mtf` | Checks if any of the Vector's components are MTF objects. | `None` | `bool`: `True` if any component is an MTF, `False` otherwise. |
| `to_numpy_array` | Converts the vector to a NumPy array. | `None` | `np.ndarray`: A NumPy array of the vector's components. |
| `to_dataframe` | Converts the Vector components into a pandas DataFrame. | `column_names` (list of str): A list of three strings to be used as the column names. | `pandas.DataFrame`: A DataFrame representing the vector's components. |

### `Bvec` Class

Represents the magnetic field vector at a point. Inherits from `Vector`.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `Bx` | `float` or `mtf` | The x-component of the B-field vector (alias for `x`). |
| `By` | `float` or `mtf` | The y-component of the B-field vector (alias for `y`). |
| `Bz` | `float` or `mtf` | The z-component of the B-field vector (alias for `z`). |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes the B-field vector. | `Bx` (mtf or float): The x-component of the field vector.<br>`By` (mtf or float): The y-component of the field vector.<br>`Bz` (mtf or float): The z-component of the field vector. | `None` |
| `to_numpy_array` | Converts the Bvec to a NumPy array. | `None` | `np.ndarray`: A NumPy array of the B-field vector's components. |
| `curl` | Calculates the curl of the B-field vector. | `None` | `Bvec`: A new `Bvec` object representing the curl of the field. |
| `divergence` | Calculates the divergence of the B-field. | `None` | `mtf`: A single MTF representing the scalar divergence of the field. |
| `gradient` | Calculates the Jacobian matrix of the B-field vector. | `None` | `np.ndarray`: A 3x3 array of MTFs representing the Jacobian matrix. |

### `Bfield` Class

A class to store a collection of `Bvec` objects.

**Attributes**

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `field_points` | `np.ndarray` | A corresponding (N, 3) NumPy array of numerical points or MTF objects. |

**Methods**

| Method | Description | Arguments | Returns |
| :--- | :--- | :--- | :--- |
| `__init__` | Initializes the Bfield container. | `b_vectors` (np.ndarray): A NumPy array of `Bvec` objects or an (N, 3) NumPy array of B-field vectors.<br>`field_points` (np.ndarray, optional): A corresponding (N, 3) NumPy array of numerical points or MTF objects. | `None` |
| `get_magnitude` | Calculates and returns the magnitude of each B-vector in the field. | `None` | `np.ndarray`: A 1D NumPy array of the magnitudes. |
| `scatter` | Creates a 2D scatter plot of the magnetic field with direction arrows on a specified plane. | `plane` (str, optional): The plane to plot on ('xy', 'yz', 'xz').<br>`value` (float, optional): The value of the coordinate held constant.<br>`title` (str, optional): The plot title.<br>`ax` (matplotlib.axes.Axes, optional): An existing Axes object to plot on. | `None` |
| `quiver` | Creates a 3D quiver plot of the magnetic field. | `title` (str, optional): The plot title.<br>`ax` (matplotlib.axes.Axes, optional): An existing 3D Axes object to plot on. | `None` |
| `max` | Returns the maximum magnitude of the B-field vectors. | `None` | `float`: The maximum magnitude. |
| `min` | Returns the minimum magnitude of the B-field vectors. | `None` | `float`: The minimum magnitude. |
| `to_dataframe` | Exports the field points and vector components to a pandas DataFrame. | `None` | `pandas.DataFrame`: A DataFrame with columns ['x', 'y', 'z', 'Bx', 'By', 'Bz']. |
